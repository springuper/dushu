# 历史阅读增强 App 开发路线图

> 本文档定义了从零到 MVP 发布的开发里程碑，每个里程碑包含具体功能点、验收标准和依赖关系。

---

## 总体目标

**MVP 目标**：完成一个可用的历史阅读增强 Web App，支持《史记》选章阅读，提供人物关系、地理时间、LLM 问答等核心功能。

**预计总工期**：8-12 周（单人开发）

---

## Milestone 1: 项目基础搭建

**目标**：完成技术栈选择、项目初始化、基础架构搭建

**预计工期**：1-2 周

### 功能点

#### 1.1 技术栈确定与项目初始化
- [ ] 确定前端技术栈：**Vite + React + TypeScript + Mantine + React Query**
  - Vite：快速构建工具，开发体验好
  - React：UI 框架
  - TypeScript：类型安全
  - Mantine：UI 组件库，提供丰富的组件和样式
  - React Query：数据获取和状态管理，简化 API 调用
- [ ] 确定后端技术栈（推荐：Node.js + Express/Fastify + TypeScript）
- [ ] 确定数据库方案（推荐：PostgreSQL + Prisma ORM）
- [ ] 初始化前后端项目
- [ ] 配置开发环境（ESLint、Prettier、Git hooks）

**验收标准**：
- 前后端项目可正常启动
- 代码规范检查通过
- Git 仓库初始化完成

#### 1.2 数据库设计与迁移
- [ ] 设计数据库 Schema（章节、段落、人物、关系、地点、事件）
- [ ] 使用 Prisma 定义数据模型
- [ ] 创建数据库迁移脚本
- [ ] 初始化数据库（本地开发环境）

**验收标准**：
- 数据库 Schema 符合 spec 6.2、6.3 定义
- 迁移脚本可成功执行
- 数据库连接正常

#### 1.3 基础 API 框架
- [ ] 搭建 Express/Fastify 服务器
- [ ] 配置路由结构（`/api/*`）
- [ ] 实现基础中间件（CORS、错误处理、日志）
- [ ] 实现健康检查接口（`GET /api/health`）

**验收标准**：
- 服务器可正常启动
- 健康检查接口返回正常
- 错误处理机制工作正常

#### 1.4 前端基础框架
- [ ] 使用 Vite 初始化 React + TypeScript 项目
- [ ] 安装和配置 Mantine UI 组件库
  - 安装 `@mantine/core`、`@mantine/hooks`、`@mantine/form` 等
  - 配置 MantineProvider 和主题
- [ ] 安装和配置 React Query
  - 安装 `@tanstack/react-query`
  - 配置 QueryClient 和 QueryClientProvider
- [ ] 配置路由（React Router）
- [ ] 实现基础布局组件（Header、Sidebar、Main）
  - 使用 Mantine 的 Layout 组件（AppShell）
- [ ] 熟悉 Mantine 组件使用（Button、Input、Card、Modal 等）
- [ ] 配置 React Query 的 API 客户端（axios 或 fetch）

**验收标准**：
- 前端项目可正常启动
- 基础布局可正常显示
- UI 组件可正常使用

---

## Milestone 2: 数据准备与内容管理后台

**目标**：完成 LLM 批量提取工具、管理后台基础功能、数据导入流程

**预计工期**：2-3 周

**依赖**：Milestone 1

### 功能点

#### 2.1 LLM 批量提取脚本
- [ ] 实现人物提取脚本（Python/Node.js）
- [ ] 实现关系提取脚本
- [ ] 实现地点提取脚本
- [ ] 配置 LLM API（OpenAI/Claude）
- [ ] 实现批量处理逻辑（分段提取、错误重试）
- [ ] 输出标准 JSON 格式

**验收标准**：
- 脚本可成功提取 1 章数据（30-40 人物、50-80 关系、20-30 地点）
- 输出 JSON 格式符合 spec 要求
- 提取准确率 ≥70%（需人工 review 验证）

#### 2.2 管理后台 - 身份验证
- [ ] 实现登录页面（`/admin/login`）
- [ ] 实现密码验证（硬编码或数据库）
- [ ] 实现 Session/Token 管理
- [ ] 实现路由守卫（未登录跳转登录页）
- [ ] 实现退出登录功能

**验收标准**：
- 未登录访问 `/admin` 自动跳转登录页
- 登录后可正常访问管理后台
- 30 分钟无操作自动登出

#### 2.3 管理后台 - 基础布局
- [ ] 实现侧边栏导航（数据准备、内容管理、系统管理）
- [ ] 实现主内容区布局
- [ ] 实现响应式设计（桌面端优先）
- [ ] 实现面包屑导航

**验收标准**：
- 布局符合 spec 5.6.2 设计
- 侧边栏可正常折叠/展开
- 移动端自适应（可选）

#### 2.4 管理后台 - Review 工具
- [ ] 实现 Review 列表视图（人物/关系/地点）
- [ ] 实现 Review 详情视图（原始数据 vs 修正数据）
- [ ] 实现审核操作（通过/拒绝/保存修改）
- [ ] 实现批量操作（批量通过/拒绝）
- [ ] 实现审核备注功能

**验收标准**：
- 可导入 LLM 提取的 JSON 文件
- 可逐项查看和编辑数据
- 可批量审核数据
- 审核状态正确保存

#### 2.5 管理后台 - 批量导入
- [ ] 实现文件上传功能（支持 JSON）
- [ ] 实现数据格式验证
- [ ] 实现导入配置（导入类型、模式）
- [ ] 实现导入结果展示（成功/失败统计）
- [ ] 实现导入日志记录

**验收标准**：
- 可成功导入 `extracted_*.json` 文件
- 数据验证错误可正确提示
- 导入后数据正确保存到数据库
- 导入日志可查询

#### 2.6 管理后台 - 内容管理基础
- [ ] 实现人物列表视图（表格、筛选、搜索）
- [ ] 实现人物编辑表单
- [ ] 实现关系列表视图
- [ ] 实现关系编辑表单
- [ ] 实现地点列表视图
- [ ] 实现地点编辑表单
- [ ] 实现状态管理（draft/pending/approved/published）

**验收标准**：
- 可查看所有节点列表
- 可创建、编辑、删除节点
- 状态变更正确保存
- 数据验证正常工作

---

## Milestone 3: 核心阅读功能

**目标**：完成章节列表、阅读界面、段落交互、进度同步

**预计工期**：2 周

**依赖**：Milestone 2（至少需要 1 章数据）

### 功能点

#### 3.1 章节列表
- [ ] 实现章节列表页面（`/` 或 `/chapters`）
- [ ] 显示章节标题、简介、阅读进度
- [ ] 实现"继续阅读"入口（显示最近阅读章节）
- [ ] 实现章节点击跳转

**验收标准**：
- 章节列表正确显示
- 阅读进度正确显示（如有）
- 点击章节可进入阅读界面

#### 3.2 阅读界面 - 基础布局
- [ ] 实现阅读页面布局（左侧阅读区 + 右侧信息面板）
- [ ] 实现阅读区（原文段落展示）
- [ ] 实现信息面板（可折叠，默认显示人物）
- [ ] 实现分隔线拖拽调整宽度

**验收标准**：
- 布局符合 spec 5.1.2 设计
- 响应式布局正常（最小宽度 1366px）
- 分隔线可正常拖拽

#### 3.3 阅读界面 - 原文展示
- [ ] 实现段落渲染（支持换行、段落间距）
- [ ] 实现段落编号显示（`[段落 3]`）
- [ ] 实现行间注释（`<sup>` 标记，点击弹出）
- [ ] 实现字号调节（小/中/大）
- [ ] 实现夜间模式切换

**验收标准**：
- 原文正确显示，格式规范
- 注释可正常点击查看
- 字号调节生效
- 夜间模式切换正常

#### 3.4 段落交互 - 高亮与浮层
- [ ] 实现人物/地点名称高亮（hover 时）
- [ ] 实现点击高亮文本弹出浮层卡片
- [ ] 实现浮层卡片内容（人物/地点基本信息）
- [ ] 实现浮层卡片关闭（点击外部/ESC）
- [ ] 实现浮层智能定位（避让边界）

**验收标准**：
- hover 时正确高亮
- 点击后浮层正确显示
- 浮层内容准确（来自数据库）
- 浮层可正常关闭

#### 3.5 进度同步
- [ ] 实现阅读位置记录（localStorage）
- [ ] 实现自动保存（滚动停止 500ms 后）
- [ ] 实现进入章节时自动定位
- [ ] 实现进度提示（"检测到上次阅读位置"）

**验收标准**：
- 阅读位置正确保存
- 再次进入章节可自动定位
- 进度提示正常显示

---

## Milestone 4: 信息面板 - 人物与关系

**目标**：完成人物列表、筛选搜索、关系图谱、关系详情

**预计工期**：2 周

**依赖**：Milestone 3

### 功能点

#### 4.1 人物列表
- [ ] 实现人物列表视图（卡片式）
- [ ] 实现人物卡片内容（头像、姓名、称号、阵营、角色、简介）
- [ ] 实现按出现频次排序
- [ ] 实现虚拟滚动（超过 20 个时）

**验收标准**：
- 人物列表正确显示
- 排序正确
- 虚拟滚动流畅（≥30 FPS）

#### 4.2 人物筛选与搜索
- [ ] 实现阵营筛选（多选按钮组）
- [ ] 实现角色类型筛选（下拉多选）
- [ ] 实现名称搜索（实时搜索，300ms 防抖）
- [ ] 实现搜索高亮匹配
- [ ] 实现组合筛选逻辑（AND）

**验收标准**：
- 筛选功能正常
- 搜索响应及时（<500ms）
- 组合筛选结果正确

#### 4.3 关系图谱
- [ ] 集成图谱库（vis.js 或 D3.js）
- [ ] 实现节点渲染（根据阵营着色）
- [ ] 实现边渲染（根据关系类型区分样式）
- [ ] 实现节点拖拽
- [ ] 实现图谱缩放（鼠标滚轮）
- [ ] 实现图谱平移（鼠标中键/拖拽空白）
- [ ] 实现节点点击显示详情

**验收标准**：
- 图谱正确渲染（8-12 个核心节点）
- 交互流畅（≥30 FPS）
- 节点点击正确显示详情

#### 4.4 关系详情
- [ ] 实现关系详情面板
- [ ] 显示双方信息、关系类型、描述、重要事件
- [ ] 实现从图谱边点击触发
- [ ] 实现从人物卡片"查看关系"触发

**验收标准**：
- 关系详情正确显示
- 触发方式正常
- 内容准确（来自数据库）

---

## Milestone 5: 信息面板 - 地理与时间

**目标**：完成地图视图、时间轴、跳转联动

**预计工期**：1.5-2 周

**依赖**：Milestone 4

### 功能点

#### 5.1 地图视图
- [ ] 集成地图库（Leaflet.js）
- [ ] 配置地图底图（OpenStreetMap 或自绘底图）
- [ ] 实现地点标记渲染（根据类型区分图标）
- [ ] 实现标记点击弹出信息卡片
- [ ] 实现地图缩放和平移
- [ ] 实现标记聚合（当地点密集时）

**验收标准**：
- 地图正确显示
- 标记正确渲染
- 点击标记正确显示信息
- 交互流畅

#### 5.2 时间轴
- [ ] 实现时间轴组件（水平时间轴）
- [ ] 实现事件节点渲染（根据类型区分图标）
- [ ] 实现时间轴缩放（鼠标滚轮）
- [ ] 实现时间轴拖拽（左右平移）
- [ ] 实现节点点击显示事件详情

**验收标准**：
- 时间轴正确显示
- 事件节点正确渲染
- 交互流畅

#### 5.3 跳转联动
- [ ] 实现地图标记点击跳转到段落
- [ ] 实现时间轴节点点击跳转到段落
- [ ] 实现关系图中地点节点点击跳转
- [ ] 实现跳转后段落高亮（3 秒后淡出）
- [ ] 实现跨章节跳转（如需要）

**验收标准**：
- 跳转功能正常
- 段落高亮正确显示
- 跨章节跳转正常（如有）

---

## Milestone 6: LLM 问答功能

**目标**：完成问答界面、上下文构建、LLM 集成、流式输出

**预计工期**：2 周

**依赖**：Milestone 3（至少需要阅读功能）

### 功能点

#### 6.1 问答界面
- [ ] 实现问答面板（聊天式界面）
- [ ] 实现输入框（多行文本，支持 Ctrl+Enter 发送）
- [ ] 实现消息列表（用户消息/助手消息）
- [ ] 实现悬浮按钮（右下角，点击展开面板）

**验收标准**：
- 界面符合 spec 5.4.1 设计
- 输入框正常工作
- 消息列表正确显示

#### 6.2 上下文构建
- [ ] 实现当前段落文本获取
- [ ] 实现相关人物摘要生成（查询数据库）
- [ ] 实现相关地点摘要生成（查询数据库）
- [ ] 实现章节背景获取
- [ ] 实现上下文拼接逻辑
- [ ] 实现上下文长度控制（4000 tokens）

**验收标准**：
- 上下文正确构建
- 长度控制正常
- 包含必要信息（段落、人物、地点、章节）

#### 6.3 LLM 集成
- [ ] 配置 LLM API（OpenAI/Claude）
- [ ] 实现提示词模板
- [ ] 实现 API 调用逻辑
- [ ] 实现错误处理（超时、失败重试）
- [ ] 实现请求日志记录

**验收标准**：
- API 调用成功
- 错误处理正常
- 响应时间 ≤6 秒（P95）

#### 6.4 流式输出
- [ ] 实现 Server-Sent Events (SSE) 或 WebSocket
- [ ] 实现流式数据接收
- [ ] 实现逐字显示（30 字/秒）
- [ ] 实现中断功能（用户点击停止）

**验收标准**：
- 流式输出正常工作
- 显示流畅（无卡顿）
- 中断功能正常

#### 6.5 引用与建议问题
- [ ] 实现引用标签识别（人物/地点/段落）
- [ ] 实现引用标签点击跳转
- [ ] 实现建议问题生成（基于段落或模板）
- [ ] 实现建议问题点击自动填充

**验收标准**：
- 引用标签正确识别和显示
- 点击引用正确跳转
- 建议问题正常生成和显示

#### 6.6 反馈机制
- [ ] 实现反馈按钮（👍 有用 / 👎 有误）
- [ ] 实现反馈表单（问题描述、正确信息）
- [ ] 实现反馈数据提交和存储
- [ ] 实现免责声明显示

**验收标准**：
- 反馈功能正常
- 反馈数据正确保存
- 免责声明正确显示

---

## Milestone 7: 优化与发布

**目标**：性能优化、错误处理完善、测试、部署

**预计工期**：1-2 周

**依赖**：Milestone 6

### 功能点

#### 7.1 性能优化
- [ ] 前端代码分割（按路由懒加载）
- [ ] 图片懒加载
- [ ] API 响应缓存（章节数据、人物列表等）
- [ ] 数据库查询优化（索引、查询优化）
- [ ] 图谱/地图渲染优化（虚拟滚动、按需加载）

**验收标准**：
- 首屏加载时间 ≤3 秒（3G 网络）
- 面板切换时间 ≤500ms
- 图谱渲染流畅（≥30 FPS）

#### 7.2 错误处理
- [ ] 实现全局错误边界（React Error Boundary）
- [ ] 实现 API 错误统一处理
- [ ] 实现用户友好的错误提示
- [ ] 实现错误日志记录

**验收标准**：
- 错误不会导致页面崩溃
- 错误提示清晰易懂
- 错误日志正确记录

#### 7.3 测试
- [ ] 编写关键功能单元测试（≥60% 覆盖率）
- [ ] 编写 API 集成测试
- [ ] 编写前端 E2E 测试（关键用户流程）
- [ ] 进行手动测试（完整用户流程）

**验收标准**：
- 单元测试通过
- 集成测试通过
- E2E 测试通过（关键流程）
- 手动测试无阻塞性问题

#### 7.4 部署准备
- [ ] 配置生产环境变量
- [ ] 配置数据库迁移脚本（生产环境）
- [ ] 配置 CI/CD 流程（可选）
- [ ] 准备部署文档
- [ ] 配置域名和 SSL 证书

**验收标准**：
- 生产环境可正常部署
- 数据库迁移成功
- 部署文档完整

#### 7.5 数据准备（生产数据）
- [ ] 完成 1 章数据的 LLM 提取和 Review
- [ ] 导入生产数据库
- [ ] 验证数据完整性
- [ ] 准备示例数据（如有需要）

**验收标准**：
- 数据完整（30-40 人物、50-80 关系、20-30 地点）
- 数据准确性验证通过
- 前端可正常显示

---

## 验收标准总结

### 功能完整性
- [ ] 所有 Milestone 功能点完成
- [ ] 核心用户流程可正常使用（阅读、查询、问答）

### 性能指标
- [ ] 首屏加载 ≤3 秒（3G 网络）
- [ ] 面板切换 ≤500ms
- [ ] LLM 响应 ≤6 秒（P95）
- [ ] 图谱/地图渲染 ≥30 FPS

### 数据质量
- [ ] 至少 1 章完整数据（30-40 人物、50-80 关系、20-30 地点）
- [ ] 数据准确性 ≥90%（人工验证）
- [ ] 所有数据有明确来源标注

### 用户体验
- [ ] 界面美观、交互流畅
- [ ] 错误提示清晰
- [ ] 移动端基本可用（可选）

---

## 风险与应对

### 技术风险
- **LLM API 不稳定**：实现重试机制、降级提示
- **图谱渲染性能**：使用虚拟滚动、按需加载
- **数据提取准确率低**：迭代优化提示词、人工 review

### 时间风险
- **开发时间超期**：优先完成核心功能（阅读 + 人物关系 + 问答）
- **数据准备耗时**：先完成 1 章数据，后续章节可逐步补充

### 质量风险
- **数据准确性**：建立 review 流程、用户反馈机制
- **LLM 回答质量**：优化提示词、收集用户反馈、持续改进

---

## 后续扩展（MVP 后）

- 多章节支持（10-15 章）
- 用户账号与个性化
- 移动端优化
- 更多书籍支持（《资治通鉴》等）
- 高级 LLM 功能（多模型、自定义提示词）

---

**文档版本**：v1.0  
**最后更新**：2024-01-XX  
**维护者**：开发团队

